<%= form_with(model: [:customer, transport_request], local: true, class: "space-y-6") do |f| %>
  <% if transport_request.errors.any? %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
      <h3 class="font-bold mb-2"><%= pluralize(transport_request.errors.count, "error") %> prohibited this request from being saved:</h3>
      <ul class="list-disc list-inside">
        <% transport_request.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Address Section: Side-by-Side -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Pickup Address (Left 50%) -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6" data-controller="address-autocomplete">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Pickup Address</h3>

      <!-- Main Address Input -->
      <div class="mb-4">
        <%= f.label :start_address, "Search Address or Company", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :start_address,
            data: { address_autocomplete_target: "input" },
            placeholder: "Start typing to search...",
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <!-- Toggle Button -->
      <div class="mb-4">
        <button type="button"
                data-address-autocomplete-target="toggleButton"
                data-action="click->address-autocomplete#toggleDetails"
                class="text-sm text-green-600 hover:text-green-800 font-medium">
          ▼ Show Details
        </button>
      </div>

      <!-- Hidden Fields -->
      <%= f.hidden_field :start_latitude, data: { address_autocomplete_target: "latitude" } %>
      <%= f.hidden_field :start_longitude, data: { address_autocomplete_target: "longitude" } %>
      <%= f.hidden_field :start_country, data: { address_autocomplete_target: "country" } %>

      <!-- Detailed Fields Section (Initially Hidden) -->
      <div data-address-autocomplete-target="detailsSection" class="hidden space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :start_company_name, "Company Name", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_company_name,
                data: { address_autocomplete_target: "companyName" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :start_street, "Street", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_street,
                data: { address_autocomplete_target: "street" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :start_street_number, "Street Number", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_street_number,
                data: { address_autocomplete_target: "streetNumber" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :start_postal_code, "Postal Code", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_postal_code,
                data: { address_autocomplete_target: "postalCode" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :start_city, "City", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_city,
                data: { address_autocomplete_target: "city" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :start_state, "State/Region", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :start_state,
                data: { address_autocomplete_target: "state" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>
        </div>

        <!-- Map Container -->
        <div data-address-autocomplete-target="mapContainer" class="w-full h-64 bg-gray-100 rounded-md border border-gray-300"></div>

        <!-- Notes -->
        <div>
          <%= f.label :start_notes, "Address Notes", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_area :start_notes,
              rows: 2,
              placeholder: "Any special instructions for this address...",
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
        </div>
      </div>
    </div>

    <!-- Delivery Address (Right 50%) -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6" data-controller="address-autocomplete">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Delivery Address</h3>

      <!-- Main Address Input -->
      <div class="mb-4">
        <%= f.label :destination_address, "Search Address or Company", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :destination_address,
            data: { address_autocomplete_target: "input" },
            placeholder: "Start typing to search...",
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <!-- Toggle Button -->
      <div class="mb-4">
        <button type="button"
                data-address-autocomplete-target="toggleButton"
                data-action="click->address-autocomplete#toggleDetails"
                class="text-sm text-green-600 hover:text-green-800 font-medium">
          ▼ Show Details
        </button>
      </div>

      <!-- Hidden Fields -->
      <%= f.hidden_field :destination_latitude, data: { address_autocomplete_target: "latitude" } %>
      <%= f.hidden_field :destination_longitude, data: { address_autocomplete_target: "longitude" } %>
      <%= f.hidden_field :destination_country, data: { address_autocomplete_target: "country" } %>

      <!-- Detailed Fields Section (Initially Hidden) -->
      <div data-address-autocomplete-target="detailsSection" class="hidden space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :destination_company_name, "Company Name", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_company_name,
                data: { address_autocomplete_target: "companyName" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :destination_street, "Street", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_street,
                data: { address_autocomplete_target: "street" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :destination_street_number, "Street Number", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_street_number,
                data: { address_autocomplete_target: "streetNumber" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :destination_postal_code, "Postal Code", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_postal_code,
                data: { address_autocomplete_target: "postalCode" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :destination_city, "City", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_city,
                data: { address_autocomplete_target: "city" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>

          <div>
            <%= f.label :destination_state, "State/Region", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :destination_state,
                data: { address_autocomplete_target: "state" },
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
          </div>
        </div>

        <!-- Map Container -->
        <div data-address-autocomplete-target="mapContainer" class="w-full h-64 bg-gray-100 rounded-md border border-gray-300"></div>

        <!-- Notes -->
        <div>
          <%= f.label :destination_notes, "Address Notes", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_area :destination_notes,
              rows: 2,
              placeholder: "Any special instructions for this address...",
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Date/Time Section: Side-by-Side -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Pickup Date & Time (Left 50%) -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Pickup Date & Time</h3>

      <div class="mb-4">
        <%= f.label :pickup_date_from, "Date & Time (15-min increments)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.datetime_local_field :pickup_date_from,
            step: 900,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :pickup_notes, "Pickup Notes", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :pickup_notes,
            rows: 3,
            placeholder: "Special instructions for pickup...",
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>
    </div>

    <!-- Delivery Date & Time (Right 50%) -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Delivery Date & Time</h3>

      <div class="mb-4">
        <%= f.label :delivery_date_from, "Date & Time (15-min increments)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.datetime_local_field :delivery_date_from,
            step: 900,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :delivery_notes, "Delivery Notes", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :delivery_notes,
            rows: 3,
            placeholder: "Special instructions for delivery...",
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>
    </div>
  </div>

  <!-- Cargo Details Section (Full Width) -->
  <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Cargo Details</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= f.label :vehicle_type, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.select :vehicle_type, [['Transporter', 'transporter'], ['LKW', 'lkw'], ['Either', 'either']], {}, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :cargo_weight_kg, "Weight (kg)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :cargo_weight_kg, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :cargo_length_cm, "Length (cm)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :cargo_length_cm, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :cargo_width_cm, "Width (cm)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :cargo_width_cm, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :cargo_height_cm, "Height (cm)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :cargo_height_cm, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>

      <div>
        <%= f.label :driver_language, class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.select :driver_language, [['German', 'de'], ['English', 'en'], ['Polish', 'pl'], ['Any', 'any']], {}, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" %>
      </div>
    </div>

    <!-- Equipment Requirements -->
    <div class="mt-6">
      <h4 class="text-sm font-semibold text-gray-700 mb-3">Equipment Requirements</h4>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <div class="flex items-center">
          <%= f.check_box :requires_liftgate, class: "h-4 w-4 text-green-600" %>
          <%= f.label :requires_liftgate, "Liftgate", class: "ml-2 text-sm" %>
        </div>

        <div class="flex items-center">
          <%= f.check_box :requires_pallet_jack, class: "h-4 w-4 text-green-600" %>
          <%= f.label :requires_pallet_jack, "Pallet Jack", class: "ml-2 text-sm" %>
        </div>

        <div class="flex items-center">
          <%= f.check_box :requires_side_loading, class: "h-4 w-4 text-green-600" %>
          <%= f.label :requires_side_loading, "Side Loading", class: "ml-2 text-sm" %>
        </div>

        <div class="flex items-center">
          <%= f.check_box :requires_tarp, class: "h-4 w-4 text-green-600" %>
          <%= f.label :requires_tarp, "Tarp", class: "ml-2 text-sm" %>
        </div>

        <div class="flex items-center">
          <%= f.check_box :requires_gps_tracking, class: "h-4 w-4 text-green-600" %>
          <%= f.label :requires_gps_tracking, "GPS Tracking", class: "ml-2 text-sm" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
    <%= link_to "Cancel", customer_transport_requests_path, class: "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium" %>
    <%= f.submit class: "px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium" %>
  </div>
<% end %>
