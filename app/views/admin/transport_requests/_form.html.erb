<%= form_with(model: [:admin, @transport_request], local: true, class: "space-y-6") do |f| %>
  <!-- Address Section: Side-by-Side -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Pickup Address (Left 50%) -->
    <div class="border border-gray-300 rounded-lg overflow-hidden bg-white" data-controller="address-autocomplete">

      <!-- Collapsed Header -->
      <button type="button"
              data-address-autocomplete-target="toggleButton"
              data-action="click->address-autocomplete#toggleDetails"
              class="w-full px-4 py-3 flex items-center justify-between transition-all hover:bg-gray-50 border-l-4 border-l-green-600">

        <div class="flex items-center gap-3">
          <div class="icon-container w-8 h-8 rounded-lg bg-green-600 flex items-center justify-center flex-shrink-0">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </div>

          <div class="text-left flex-1 min-w-0">
            <div class="text-xs font-semibold text-gray-600 uppercase tracking-wide mb-0.5">
              Pickup Address
            </div>
            <div class="display-text text-sm font-medium text-gray-900 truncate">
              <%= @transport_request.start_address.present? ? @transport_request.start_address : 'Enter pickup address' %>
            </div>
          </div>
        </div>

        <svg class="w-5 h-5 text-gray-400 chevron-icon transition-transform flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <!-- Expanded Content -->
      <div data-address-autocomplete-target="detailsSection" class="p-6 border-t border-gray-200 bg-gray-50 space-y-4">
        <!-- Main Address Input -->
        <div>
          <%= f.label :start_address, "Search Address or Company", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
          <%= f.text_field :start_address,
              data: { address_autocomplete_target: "input" },
              placeholder: "Start typing to search...",
              class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <!-- Hidden Fields -->
        <%= f.hidden_field :start_latitude, data: { address_autocomplete_target: "latitude" } %>
        <%= f.hidden_field :start_longitude, data: { address_autocomplete_target: "longitude" } %>
        <%= f.hidden_field :start_country, data: { address_autocomplete_target: "country" } %>

        <!-- Detailed Fields -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :start_company_name, "Company Name", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_company_name,
                data: { address_autocomplete_target: "companyName" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :start_street, "Street", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_street,
                data: { address_autocomplete_target: "street" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :start_street_number, "Street Number", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_street_number,
                data: { address_autocomplete_target: "streetNumber" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :start_postal_code, "Postal Code", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_postal_code,
                data: { address_autocomplete_target: "postalCode" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :start_city, "City", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_city,
                data: { address_autocomplete_target: "city" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :start_state, "State/Region", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :start_state,
                data: { address_autocomplete_target: "state" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>
        </div>

        <!-- Map Container -->
        <div data-address-autocomplete-target="mapContainer" class="w-full h-64 bg-gray-100 rounded-lg border border-gray-300"></div>

        <!-- Notes -->
        <div>
          <%= f.label :start_notes, "Address Notes", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
          <%= f.text_area :start_notes,
              rows: 3,
              placeholder: "Any special instructions for this address...",
              class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>
      </div>
    </div>

    <!-- Delivery Address (Right 50%) -->
    <div class="border border-gray-300 rounded-lg overflow-hidden bg-white" data-controller="address-autocomplete">

      <!-- Collapsed Header -->
      <button type="button"
              data-address-autocomplete-target="toggleButton"
              data-action="click->address-autocomplete#toggleDetails"
              class="w-full px-4 py-3 flex items-center justify-between transition-all hover:bg-gray-50 border-l-4 border-l-blue-600">

        <div class="flex items-center gap-3">
          <div class="icon-container w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center flex-shrink-0">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
          </div>

          <div class="text-left flex-1 min-w-0">
            <div class="text-xs font-semibold text-gray-600 uppercase tracking-wide mb-0.5">
              Delivery Address
            </div>
            <div class="display-text text-sm font-medium text-gray-900 truncate">
              <%= @transport_request.destination_address.present? ? @transport_request.destination_address : 'Enter delivery address' %>
            </div>
          </div>
        </div>

        <svg class="w-5 h-5 text-gray-400 chevron-icon transition-transform flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <!-- Expanded Content -->
      <div data-address-autocomplete-target="detailsSection" class="p-6 border-t border-gray-200 bg-gray-50 space-y-4">
        <!-- Main Address Input -->
        <div>
          <%= f.label :destination_address, "Search Address or Company", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
          <%= f.text_field :destination_address,
              data: { address_autocomplete_target: "input" },
              placeholder: "Start typing to search...",
              class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>

        <!-- Hidden Fields -->
        <%= f.hidden_field :destination_latitude, data: { address_autocomplete_target: "latitude" } %>
        <%= f.hidden_field :destination_longitude, data: { address_autocomplete_target: "longitude" } %>
        <%= f.hidden_field :destination_country, data: { address_autocomplete_target: "country" } %>

        <!-- Detailed Fields -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <%= f.label :destination_company_name, "Company Name", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_company_name,
                data: { address_autocomplete_target: "companyName" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :destination_street, "Street", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_street,
                data: { address_autocomplete_target: "street" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :destination_street_number, "Street Number", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_street_number,
                data: { address_autocomplete_target: "streetNumber" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :destination_postal_code, "Postal Code", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_postal_code,
                data: { address_autocomplete_target: "postalCode" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :destination_city, "City", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_city,
                data: { address_autocomplete_target: "city" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>

          <div>
            <%= f.label :destination_state, "State/Region", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
            <%= f.text_field :destination_state,
                data: { address_autocomplete_target: "state" },
                class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          </div>
        </div>

        <!-- Map Container -->
        <div data-address-autocomplete-target="mapContainer" class="w-full h-64 bg-gray-100 rounded-lg border border-gray-300"></div>

        <!-- Notes -->
        <div>
          <%= f.label :destination_notes, "Address Notes", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
          <%= f.text_area :destination_notes,
              rows: 3,
              placeholder: "Any special instructions for this address...",
              class: "w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
        </div>
      </div>
    </div>
  </div>

  <!-- Date/Time Section: Side-by-Side Calendar & Time Picker -->
  <div data-controller="datetime-picker">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Pickup Section (Left) -->
      <%= render 'admin/transport_requests/partials/datetime_section', f: f, field_prefix: 'pickup' %>

      <!-- Delivery Section (Right - always visible, disabled until pickup selected) -->
      <%= render 'admin/transport_requests/partials/datetime_section', f: f, field_prefix: 'delivery' %>
    </div>

    <!-- Validation Error -->
    <div data-datetime-picker-target="validationError" class="hidden mt-4"></div>

    <!-- Success Summary -->
    <div data-datetime-picker-target="successSummary" class="hidden mt-4"></div>
  </div>

  <!-- Cargo/Shipping Mode Section -->
  <div class="bg-white border border-gray-200 rounded-lg p-6"
       data-controller="shipping-mode"
       data-shipping-mode-default-mode-value="<%= @transport_request.shipping_mode || 'packages' %>">

    <h3 class="text-base font-semibold text-gray-900 mb-6">Wie möchten Sie Ihre Ware versenden?</h3>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
      <nav class="flex space-x-8">
        <button type="button"
                data-mode="packages"
                data-action="shipping-mode#switch"
                data-shipping-mode-target="tab"
                class="py-4 px-1 border-b-2 font-medium text-sm transition border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
          📦 Paletten & mehr
        </button>
        <button type="button"
                data-mode="loading_meters"
                data-action="shipping-mode#switch"
                data-shipping-mode-target="tab"
                class="py-4 px-1 border-b-2 font-medium text-sm transition border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
          📏 Lademeter
        </button>
        <button type="button"
                data-mode="vehicle_booking"
                data-action="shipping-mode#switch"
                data-shipping-mode-target="tab"
                class="py-4 px-1 border-b-2 font-medium text-sm transition border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
          🚚 Fahrzeugbuchung
        </button>
      </nav>
    </div>

    <%= f.hidden_field :shipping_mode, data: { shipping_mode_target: "modeInput" } %>

    <!-- Panel: Paletten & mehr -->
    <div data-shipping-mode-target="panel" data-mode="packages" class="hidden">
      <%= render 'admin/transport_requests/partials/packages_panel', f: f %>
    </div>

    <!-- Panel: Lademeter -->
    <div data-shipping-mode-target="panel" data-mode="loading_meters" class="hidden">
      <%= render 'admin/transport_requests/partials/loading_meters_panel', f: f %>
    </div>

    <!-- Panel: Fahrzeugbuchung -->
    <div data-shipping-mode-target="panel" data-mode="vehicle_booking" class="hidden">
      <%= render 'admin/transport_requests/partials/vehicle_booking_panel', f: f %>
    </div>
  </div>

  <!-- Equipment Requirements (shown for packages mode) -->
  <div class="bg-white border border-gray-200 rounded-lg p-6">
    <h3 class="text-base font-semibold text-gray-900 mb-6">Equipment Requirements</h3>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
      <div class="flex items-center">
        <%= f.check_box :requires_liftgate, class: "h-4 w-4 text-blue-600 rounded" %>
        <%= f.label :requires_liftgate, "Liftgate", class: "ml-2 text-sm text-gray-700" %>
      </div>

      <div class="flex items-center">
        <%= f.check_box :requires_pallet_jack, class: "h-4 w-4 text-blue-600 rounded" %>
        <%= f.label :requires_pallet_jack, "Pallet Jack", class: "ml-2 text-sm text-gray-700" %>
      </div>

      <div class="flex items-center">
        <%= f.check_box :requires_side_loading, class: "h-4 w-4 text-blue-600 rounded" %>
        <%= f.label :requires_side_loading, "Side Loading", class: "ml-2 text-sm text-gray-700" %>
      </div>

      <div class="flex items-center">
        <%= f.check_box :requires_tarp, class: "h-4 w-4 text-blue-600 rounded" %>
        <%= f.label :requires_tarp, "Tarp", class: "ml-2 text-sm text-gray-700" %>
      </div>

      <div class="flex items-center">
        <%= f.check_box :requires_gps_tracking, class: "h-4 w-4 text-blue-600 rounded" %>
        <%= f.label :requires_gps_tracking, "GPS Tracking", class: "ml-2 text-sm text-gray-700" %>
      </div>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="bg-white border border-gray-200 rounded-lg p-6">
    <div class="flex justify-end space-x-4">
      <%= link_to "Cancel", admin_transport_requests_path, class: "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium" %>
      <%= f.submit class: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium" %>
    </div>
  </div>
<% end %>
