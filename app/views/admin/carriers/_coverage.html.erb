<h3 class="text-lg font-semibold text-gray-900 mb-4">Service Coverage Area</h3>

<!-- Service Radius Info -->
<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
  <div class="flex items-start">
    <div class="flex-shrink-0">
      <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
      </svg>
    </div>
    <div class="ml-3 flex-1">
      <h3 class="text-sm font-medium text-blue-800">
        Service Radius:
        <% if carrier.ignore_radius %>
          <span class="font-bold">Unlimited</span>
          <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">No Radius Limit</span>
        <% elsif carrier.pickup_radius_km.present? %>
          <span class="font-bold"><%= carrier.pickup_radius_km %> km</span> from carrier location
        <% else %>
          <span class="font-bold text-gray-500">Not set</span>
        <% end %>
      </h3>
      <% unless carrier.ignore_radius %>
        <div class="mt-2 text-sm text-blue-700">
          The map below shows the service radius circle around the carrier's location. Transport requests with pickup locations within this radius will match this carrier.
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Service Radius Map -->
<% if carrier.latitude && carrier.longitude %>
  <div class="mb-6">
    <div data-controller="map"
         data-map-single-lat-value="<%= carrier.latitude %>"
         data-map-single-lng-value="<%= carrier.longitude %>"
         data-map-radius-value="<%= carrier.pickup_radius_km || 0 %>"
         data-map-show-radius-value="<%= carrier.pickup_radius_km.present? && !carrier.ignore_radius %>">
      <div data-map-target="container" style="height: 400px; width: 100%; border-radius: 0.5rem;" class="border border-gray-200"></div>
    </div>
  </div>
<% else %>
  <div class="mb-6 p-6 bg-gray-50 border border-gray-200 rounded-lg text-center">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
    <p class="mt-2 text-sm text-gray-600">No location coordinates available. Add an address to see the service radius map.</p>
  </div>
<% end %>

<!-- Pickup Countries -->
<div class="mb-6">
  <h4 class="text-md font-semibold text-gray-900 mb-3">Pickup Countries</h4>
  <% if carrier.pickup_countries.present? && carrier.pickup_countries.any? %>
    <div class="flex flex-wrap gap-2">
      <% carrier.pickup_countries.each do |country_code| %>
        <span class="inline-flex items-center px-3 py-1.5 rounded-md text-sm font-medium bg-green-100 text-green-800 border border-green-200">
          <span class="mr-1.5"><%= country_flag(country_code) %></span>
          <%= country_code %>
        </span>
      <% end %>
    </div>
  <% else %>
    <p class="text-sm text-gray-500 italic">No pickup countries specified</p>
  <% end %>
</div>

<!-- Delivery Countries -->
<div class="mb-6">
  <h4 class="text-md font-semibold text-gray-900 mb-3">Delivery Countries</h4>
  <% if carrier.delivery_countries.present? && carrier.delivery_countries.any? %>
    <div class="flex flex-wrap gap-2">
      <% carrier.delivery_countries.each do |country_code| %>
        <span class="inline-flex items-center px-3 py-1.5 rounded-md text-sm font-medium bg-blue-100 text-blue-800 border border-blue-200">
          <span class="mr-1.5"><%= country_flag(country_code) %></span>
          <%= country_code %>
        </span>
      <% end %>
    </div>
  <% else %>
    <p class="text-sm text-gray-500 italic">No delivery countries specified</p>
  <% end %>
</div>

<!-- Coverage Summary -->
<div class="bg-gray-50 rounded-lg p-4">
  <h4 class="text-sm font-semibold text-gray-700 mb-2">Coverage Summary</h4>
  <dl class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
    <div>
      <dt class="text-gray-600">Pickup Coverage:</dt>
      <dd class="font-medium text-gray-900">
        <%= carrier.pickup_countries&.count || 0 %> countries
      </dd>
    </div>
    <div>
      <dt class="text-gray-600">Delivery Coverage:</dt>
      <dd class="font-medium text-gray-900">
        <%= carrier.delivery_countries&.count || 0 %> countries
      </dd>
    </div>
    <div>
      <dt class="text-gray-600">Service Radius:</dt>
      <dd class="font-medium text-gray-900">
        <% if carrier.ignore_radius %>
          Unlimited
        <% elsif carrier.pickup_radius_km %>
          <%= carrier.pickup_radius_km %> km
        <% else %>
          Not set
        <% end %>
      </dd>
    </div>
    <div>
      <dt class="text-gray-600">Location Set:</dt>
      <dd class="font-medium text-gray-900">
        <%= carrier.latitude && carrier.longitude ? 'Yes' : 'No' %>
      </dd>
    </div>
  </dl>
</div>

<%# Helper to display country flags (simple emoji mapping) %>
<%
def country_flag(country_code)
  flags = {
    'DE' => 'ðŸ‡©ðŸ‡ª', 'PL' => 'ðŸ‡µðŸ‡±', 'AT' => 'ðŸ‡¦ðŸ‡¹', 'CH' => 'ðŸ‡¨ðŸ‡­',
    'FR' => 'ðŸ‡«ðŸ‡·', 'IT' => 'ðŸ‡®ðŸ‡¹', 'NL' => 'ðŸ‡³ðŸ‡±', 'BE' => 'ðŸ‡§ðŸ‡ª',
    'ES' => 'ðŸ‡ªðŸ‡¸', 'CZ' => 'ðŸ‡¨ðŸ‡¿', 'SK' => 'ðŸ‡¸ðŸ‡°', 'HU' => 'ðŸ‡­ðŸ‡º',
    'RO' => 'ðŸ‡·ðŸ‡´', 'BG' => 'ðŸ‡§ðŸ‡¬', 'HR' => 'ðŸ‡­ðŸ‡·', 'SI' => 'ðŸ‡¸ðŸ‡®',
    'DK' => 'ðŸ‡©ðŸ‡°', 'SE' => 'ðŸ‡¸ðŸ‡ª', 'NO' => 'ðŸ‡³ðŸ‡´', 'FI' => 'ðŸ‡«ðŸ‡®'
  }
  flags[country_code.upcase] || 'ðŸ³ï¸'
end
%>
