<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Customer Portal - Matchmaking Platform" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="google-maps-api-key" content="<%= Rails.application.credentials.dig(:google_maps, :api_key) %>">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.dig(:google_maps, :api_key) %>&libraries=places" async defer></script>
  </head>

  <body class="bg-gray-50">
    <div class="flex h-screen">
      <!-- Sidebar -->
      <aside class="w-64 bg-green-900 text-white flex-shrink-0">
        <div class="p-6">
          <h1 class="text-2xl font-bold">Logistics</h1>
          <p class="text-green-200 text-sm"><%= current_user&.company_name %></p>
        </div>

        <nav class="mt-6">
          <%= link_to customer_dashboard_path, class: "block px-6 py-3 hover:bg-green-800 #{current_page?(customer_dashboard_path) ? 'bg-green-800' : ''}" do %>
            <span class="text-lg">ðŸ“Š Dashboard</span>
          <% end %>

          <%= link_to customer_transport_requests_path, class: "block px-6 py-3 hover:bg-green-800 #{current_page?(customer_transport_requests_path) ? 'bg-green-800' : ''}" do %>
            <span class="text-lg">ðŸ“¦ My Requests</span>
          <% end %>
        </nav>

        <div class="absolute bottom-0 w-64 p-6 border-t border-green-800">
          <p class="text-sm text-green-200"><%= current_user&.email %></p>

          <!-- Language Switcher -->
          <div class="mt-3">
            <%= form_with url: switch_locale_path, method: :post, local: true, class: "inline-block" do |f| %>
              <%= f.select :locale,
                  options_for_select(
                    [['ðŸ‡©ðŸ‡ª Deutsch', 'de'], ['ðŸ‡¬ðŸ‡§ English', 'en']],
                    I18n.locale.to_s
                  ),
                  {},
                  {
                    onchange: 'this.form.submit()',
                    class: 'text-sm border border-green-700 bg-green-800 text-green-100 rounded px-2 py-1 cursor-pointer hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500'
                  }
              %>
            <% end %>
          </div>

          <%= button_to "Logout", destroy_user_session_path, method: :delete, class: "mt-3 text-sm text-green-200 hover:text-white" %>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm">
          <div class="px-6 py-4 flex justify-between items-center">
            <h2 class="text-2xl font-semibold text-gray-800"><%= yield :page_title %></h2>
            <%= link_to "New Request", new_customer_transport_request_path,
                class: "px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" %>
          </div>
        </header>

        <!-- Flash Messages -->
        <% if notice %>
          <div class="mx-6 mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
            <%= notice %>
          </div>
        <% end %>
        <% if alert %>
          <div class="mx-6 mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
            <%= alert %>
          </div>
        <% end %>

        <!-- Page Content -->
        <main class="flex-1 overflow-y-auto p-6">
          <%= yield %>
        </main>
      </div>
    </div>
  </body>
</html>
